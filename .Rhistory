# Import libraries
library(tidyverse) # collection of R packages designed for data science
# Number formatting
options(scipen = 1000000)
options(digits = 6)
htmltools::img(src = knitr::image_uri("https://github.com/statistikZH/covid19monitoring/blob/master/KtZuerichLogo.png"),
alt = 'logo',
style = 'position:absolute; top:0; right:0; padding:0px;')
# clear R memory
# rm(list = ls())
# import libraries
library(tidyverse)
options(scipen = 1000000)
options(digits = 6)
dir_name <- "./Download"
dir.create(dir_name)
downloader::download("https://www.intervista.ch/media/2020/03/Download_Mobilit%C3%A4ts-Monitoring_Covid-19.zip",
dest=paste0(dir_name,"/Download.zip"),
mode="wb")
unzip(paste0(dir_name,"/Download.zip"), exdir = dir_name)
dat <-  read.csv("./Download/Mittelwerte_und_Median_pro_Tag.csv", header=T, sep=";", stringsAsFactors=FALSE, encoding="ANSI_X3.4-1986")
#dat_CH
dat_CH <- dat %>%
select(-"Zürich_Ja", -"Zürich_Nein", -"Ticino_Ja", -"Ticino_Nein",-"Französische_Schweiz", -"Alpen_und_Voralpen", -"Westmittelland" ,-"Ostmittelland", -"Italienische_Schweiz", -"D.CH", -"W.CH", -"I.CH") %>%
pivot_longer(
cols =  c("Total", "Alter_15.29", "Alter_30.59", "Alter_60..", "Alter_65..","Alter_15.64" , "Männlich", "Weiblich", "Städtisch" ,"Ländlich"),
names_to = "variable_short",
values_to = "value"
) %>%
mutate(location = "CH")
View(dat)
dat <-  read.csv("./Download/Mittelwerte_und_Median_pro_Tag.csv", header=T, sep=",", stringsAsFactors=FALSE, encoding="ANSI_X3.4-1986")
View(dat)
#dat_CH
dat_CH <- dat %>%
select(-"Zürich_Ja", -"Zürich_Nein", -"Ticino_Ja", -"Ticino_Nein",-"Französische_Schweiz", -"Alpen_und_Voralpen", -"Westmittelland" ,-"Ostmittelland", -"Italienische_Schweiz", -"D.CH", -"W.CH", -"I.CH") %>%
pivot_longer(
cols =  c("Total", "Alter_15.29", "Alter_30.59", "Alter_60..", "Alter_65..","Alter_15.64" , "Männlich", "Weiblich", "Städtisch" ,"Ländlich"),
names_to = "variable_short",
values_to = "value"
) %>%
mutate(location = "CH")
names(dat)
?image_uri
file.path("./KtZuerichLogo.png")
class(file.path("./KtZuerichLogo.png"))
#Mobility_Intervista
url_Mobility_Intervista  <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <-data.frame(read_csv(url(url_Mobility_Intervista)))
# import libraries
library(readr)
sessionInfo()
packageVersion("readr")
Mobility_Intervista <- mread.csv(url(url_Mobility_Intervista), header=T, sep=",t", stringsAsFactors=FALSE, encoding="UTF-8")
url_Mobility_Intervista  <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",t", stringsAsFactors=FALSE, encoding="UTF-8")
#Mobility_Intervista
url_Mobility_Intervista  <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
View(Mobility_Intervista)
#Mobility_Intervista
url_Mobility_Intervista  <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Other_Weather
url_Other_Weather <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_other_Weather/master/Other_Weather.csv"
Other_Weather <- read.csv(url(url_Other_Weather), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#url_Economy_FlightTrafficZRH="https://github.com/statistikZH/covid19monitoring_economy_FlightTraffic/blob/master/Economy_FlightTrafficZRH.csv"
#Economy_FlightTrafficZRH<-data.frame(read_csv(url(url_Economy_FlightTrafficZRH)))
source("./function.R")
CheckIfDfFollowsStandard(Mobility_Intervista)
source("./function.R")
CheckIfDfFollowsStandard(Mobility_Intervista)
CheckIfDfFollowsStandard(Other_Weather)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather)
write.table(covid19monitoring, "./covid19monitoring.csv", sep=",", fileEncoding="UTF-8", row.names = F)
names(covid19monitoring)
Metadata <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
names(Metadata)
View(Metadata)
Metadata_prep <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
Metadata <- df[!duplicated(Metadata_prep[names(Metadata_prep)]),]
!duplicated(Metadata_prep[names(Metadata_prep)])
Metadata <- Metadata_prep[!duplicated(Metadata_prep[names(Metadata_prep)]),]
View(Metadata)
CreateMetadata()
source("./function.R")
CreateMetadata()
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep="\t", stringsAsFactors=FALSE, encoding="UTF-8")
Metadata_prep <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
Metadata <- Metadata_prep[!duplicated(Metadata_prep[names(Metadata_prep)]),]
write.table(Metadata, "./Metadata.csv", sep=",", fileEncoding="UTF-8", row.names = F)
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep="\t", stringsAsFactors=FALSE, encoding="UTF-8")
Metadata_prep <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
Metadata <- Metadata_prep[!duplicated(Metadata_prep[names(Metadata_prep)]),]
!duplicated(Metadata_prep[names(Metadata_prep)])
!duplicated(Metadata_prep[names(Metadata_prep)
)
unique_rows <- !duplicated(covid19monitoring_sel[name(covid19monitoring_sel)])
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep="\t", stringsAsFactors=FALSE, encoding="UTF-8")
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
unique_rows <- !duplicated(covid19monitoring_sel[name(covid19monitoring_sel)])
unique_rows <- !duplicated(covid19monitoring_sel[names(covid19monitoring_sel)])
Metadata <- covid19monitoring_sel[unique_rows,]
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep="\t", stringsAsFactors=FALSE, encoding="UTF-8")
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
unique_rows <- !duplicated(covid19monitoring_sel[names(covid19monitoring_sel)])
Metadata <- covid19monitoring_sel[unique_rows,]
unique_rows
names(covid19monitoring_sel)
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep="\t", stringsAsFactors=FALSE, encoding="UTF-8")
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
covid19monitoring_sel
names(covid19monitoring_sel)
View(covid19monitoring_sel)
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
View(covid19monitoring)
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
unique_rows <- !duplicated(df[c("var1","var2")])
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
unique_rows <- !duplicated(df[names(covid19monitoring_sel)])
covid19monitoring <- read.csv("./covid19monitoring.csv", header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
covid19monitoring_sel <- covid19monitoring[, ! names(covid19monitoring) %in% c("date", "value")]
unique_rows <- !duplicated(covid19monitoring_sel[names(covid19monitoring_sel)])
covid19monitoring_sel
View(covid19monitoring_sel)
unique_rows
View(unique_rows)
Metadata <- Metadata_prep[!duplicated(Metadata_prep[names(Metadata_prep)]),]
Metadata <- covid19monitoring_sel[unique_rows,]
View(Metadata)
source("./function.R")
CreateMetadata()
View(covid19monitoring)
nrow(url_Mobility_Intervista)
nrow(url_Other_Weather)
#Mobility_Intervista
url_Mobility_Intervista  <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Other_Weather
url_Other_Weather <- "https://raw.githubusercontent.com/statistikZH/covid19monitoring_other_Weather/master/Other_Weather.csv"
Other_Weather <- read.csv(url(url_Other_Weather), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#url_Economy_FlightTrafficZRH="https://github.com/statistikZH/covid19monitoring_economy_FlightTraffic/blob/master/Economy_FlightTrafficZRH.csv"
#Economy_FlightTrafficZRH<-data.frame(read_csv(url(url_Economy_FlightTrafficZRH)))
nrow(Mobility_Intervista)
nrow(Other_Weather)
888+588
nrow(Metadata)
nrow(covid19monitoring)
CheckIfDfFollowsStandard(Mobility_Intervista)
CheckIfDfFollowsStandard(Mobility_Intervista)
CheckIfDfFollowsStandard(Other_Weather)
CheckIfDfFollowsStandard(Other_Weather)
CheckIfDfFollowsStandard(Mobility_Intervista)
source("./function.R")
CreateMetadata()
install.packages("DT")
# Download data
urlfile="https://raw.githubusercontent.com/statistikZH/covid19monitoring/master/covid19monitoring.csv"
cons<-data.frame(read_delim(url(urlfile), delim=","))
cons$date<-as.POSIXct(cons$date)
cons<-cons[order(cons$location, cons$variable_short, cons$date),]
cons<-subset(cons, date>"01-01-2020")
# Intervista----
options(encoding = "UTF-8")
c("tages_distanz_median", "tages_distanz_median_alter_1529",
"tages_distanz_median_alter_3064", "tages_distanz_median_alter_6579",
"tages_distanz_median_erwebstaetig", "tages_distanz_median_in_ausbildung",
"tages_distanz_median_maennlich", "tages_distanz_median_nicht_erwerbstaetig",
"tages_distanz_median_weiblich", "tages_radius_median", "tages_radius_median_alter_1529",
"tages_radius_median_alter_3064", "tages_radius_median_alter_6579",
"tages_radius_median_erwebstaetig", "tages_radius_median_in_ausbildung",
"tages_radius_median_maennlich", "tages_radius_median_nicht_erwerbstaetig",
"tages_radius_median_weiblich")
read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_mobility_intervista\\Mobility_Intervista.csv")
intervista<-read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_mobility_intervista\\Mobility_Intervista.csv")
ii<-intervista[order(intervista$location,
intervista$variable_short, as.POSIXct(intervista$date)),]
with(subset(ii, variable_short%in%c("tages_distanz_median_alter_1529",
"tages_distanz_median_alter_3064", "tages_distanz_median_alter_6579")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median_maennlich",
"tages_distanz_median_weiblich")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median_erwerbstaetig", "tages_distanz_median_in_ausbildung",
"tages_distanz_median_nicht_erwerbstaetig")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median") & location%in%c("CH", "ZH")),
xyplot(value~as.POSIXct(date), groups=location, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median", "tages_radius_median") & location%in%c("CH")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
#wetter-----
c("globalstrahlung", "luftdruck", "luftfeuchte", "sonnenschein",
"temp_max", "temp_min", "temp_mittel")
aa<-read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_other_Weather\\Other_Weather.csv")
ii<-aa[order(aa$location, aa$variable_short, as.POSIXct(aa$date)),]
with(subset(ii, variable_short%in% c("temp_max", "temp_min", "temp_mittel")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("globalstrahlung")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("luftdruck")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("temp_max", "temp_min", "temp_mittel")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
# zrh----
with(subset(cons, variable_short =="fluege_zrh"),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
library(hochr)
library(xts)
lusualib()
#  Other_Weather.R
# Import libraries
require(tidyquant)
require(xts)
require(anytime)
library (readr)
library (lattice)
library(chron)
library(reshape)
library(readr)
# Download data
urlfile="https://raw.githubusercontent.com/statistikZH/covid19monitoring/master/covid19monitoring.csv"
cons<-data.frame(read_delim(url(urlfile), delim=","))
cons$date<-as.POSIXct(cons$date)
cons<-cons[order(cons$location, cons$variable_short, cons$date),]
cons<-subset(cons, date>"01-01-2020")
# Intervista----
options(encoding = "UTF-8")
c("tages_distanz_median", "tages_distanz_median_alter_1529",
"tages_distanz_median_alter_3064", "tages_distanz_median_alter_6579",
"tages_distanz_median_erwebstaetig", "tages_distanz_median_in_ausbildung",
"tages_distanz_median_maennlich", "tages_distanz_median_nicht_erwerbstaetig",
"tages_distanz_median_weiblich", "tages_radius_median", "tages_radius_median_alter_1529",
"tages_radius_median_alter_3064", "tages_radius_median_alter_6579",
"tages_radius_median_erwebstaetig", "tages_radius_median_in_ausbildung",
"tages_radius_median_maennlich", "tages_radius_median_nicht_erwerbstaetig",
"tages_radius_median_weiblich")
read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_mobility_intervista\\Mobility_Intervista.csv")
intervista<-read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_mobility_intervista\\Mobility_Intervista.csv")
ii<-intervista[order(intervista$location,
intervista$variable_short, as.POSIXct(intervista$date)),]
with(subset(ii, variable_short%in%c("tages_distanz_median_alter_1529",
"tages_distanz_median_alter_3064", "tages_distanz_median_alter_6579")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median_maennlich",
"tages_distanz_median_weiblich")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median_erwerbstaetig", "tages_distanz_median_in_ausbildung",
"tages_distanz_median_nicht_erwerbstaetig")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median") & location%in%c("CH", "ZH")),
xyplot(value~as.POSIXct(date), groups=location, type="l"))
with(subset(ii, variable_short%in%c("tages_distanz_median", "tages_radius_median") & location%in%c("CH")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
#wetter-----
c("globalstrahlung", "luftdruck", "luftfeuchte", "sonnenschein",
"temp_max", "temp_min", "temp_mittel")
aa<-read.csv("C:\\Users\\pm\\Wissenschaft\\monitoring covid\\covid19monitoring_other_Weather\\Other_Weather.csv")
ii<-aa[order(aa$location, aa$variable_short, as.POSIXct(aa$date)),]
with(subset(ii, variable_short%in% c("temp_max", "temp_min", "temp_mittel")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("globalstrahlung")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("luftdruck")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
with(subset(ii, variable_short%in% c("temp_max", "temp_min", "temp_mittel")),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
# zrh----
with(subset(cons, variable_short =="fluege_zrh"),
xyplot(value~as.POSIXct(date), groups=variable_short, type="l"))
#Mobility_Intervista
url_Mobility_Intervista  <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Other_Weather
url_Other_Weather <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_other_Weather/master/Other_Weather.csv"
Other_Weather <- read.csv(url(url_Other_Weather), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Economy_FlightTrafficZRH
url_Economy_FlightTrafficZRH <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_economy_FlightTraffic/master/Economy_FlightTraffic.csv"
Economy_FlightTrafficZRH <- read.csv(url(url_Economy_FlightTrafficZRH), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
source("./function.R")
CheckIfDfFollowsStandard(Mobility_Intervista)
CheckIfDfFollowsStandard(Other_Weather)
CheckIfDfFollowsStandard(Economy_FlightTrafficZRH)
write.table(covid19socialmonitoring_20200328_beta, "./internalcheck.csv", sep=",", fileEncoding="UTF-8", row.names = F)
write.table(covid19monitoring, "./internalcheck.csv", sep=",", fileEncoding="UTF-8", row.names = F)
write.table(covid19monitoring, "./internalcheck.csv", sep=",", fileEncoding="UTF-8", row.names = F)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather, Economy_FlightTrafficZRH)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather, Economy_FlightTrafficZRH)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather, Economy_FlightTrafficZRH)
#Mobility_Intervista
url_Mobility_Intervista  <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_mobility_intervista/master/Mobility_Intervista.csv"
Mobility_Intervista <- read.csv(url(url_Mobility_Intervista), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Other_Weather
url_Other_Weather <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_other_Weather/master/Other_Weather.csv"
Other_Weather <- read.csv(url(url_Other_Weather), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
#Economy_FlightTrafficZRH
url_Economy_FlightTrafficZRH <-
"https://raw.githubusercontent.com/statistikZH/covid19monitoring_economy_FlightTraffic/master/Economy_FlightTraffic.csv"
Economy_FlightTrafficZRH <- read.csv(url(url_Economy_FlightTrafficZRH), header=T, sep=",", stringsAsFactors=FALSE, encoding="UTF-8")
source("./function.R")
CheckIfDfFollowsStandard(Mobility_Intervista)
CheckIfDfFollowsStandard(Other_Weather)
CheckIfDfFollowsStandard(Economy_FlightTrafficZRH)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather, Economy_FlightTrafficZRH)
covid19monitoring <- rbind(Mobility_Intervista, Other_Weather, Economy_FlightTrafficZRH)
write.table(covid19monitoring, "./internalcheck.csv", sep=",", fileEncoding="UTF-8", row.names = F)
file.copy("./internalcheck.csv", "./covid19monitoring.csv", overwrite = TRUE)
file.copy("./internalcheck.csv", "./covid19socialmonitoring_20200328_beta.csv", overwrite = TRUE)
source("./function.R")
CreateMetadata()
file.copy("./internalcheck.csv", "./covid19socialmonitoring_beta.csv", overwrite = TRUE)
